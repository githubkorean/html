<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ìˆ«ì ì¶”ë¦¬ ê²Œì„ ë„ìš°ë¯¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --container-bg-color: #2c2c2c;
            --text-color: #f1f1f1;
            --primary-color: #4a90e2;
            --primary-hover-color: #3b7ad1;
            --input-bg-color: #383838;
            --input-border-color: #555;
            --log-bg-color: #232323;
            --log-border-color: #444;
            --font-family: 'Noto Sans KR', sans-serif;
            --tooltip-bg-color: #444;
            --tooltip-text-color: #fff;
            --warning-color: #e53e3e;
            --warning-hover-color: #c53030;
        }

        * {
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        body {
            background: var(--bg-color);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
        }

        .container {
            background: var(--container-bg-color);
            border-radius: 12px;
            padding: 30px;
            width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        .header-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-box h2 {
            margin: 0;
            font-weight: bold;
            color: var(--primary-color);
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-group button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .setting-group button.warning {
            background-color: var(--warning-color);
        }
        
        .setting-group button.warning:hover {
            background-color: var(--warning-hover-color);
        }

        .guess-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            background: rgba(74, 144, 226, 0.1);
        }

        .guess-input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .guess-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            background: var(--input-bg-color);
            color: var(--text-color);
            border: 2px solid var(--input-border-color);
            border-radius: 6px;
            transition: border 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: var(--primary-hover-color);
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        .log {
            height: 200px;
            overflow-y: auto;
            background: var(--log-bg-color);
            border: 1px solid var(--log-border-color);
            padding: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9rem;
            border-radius: 6px;
            white-space: pre-line;
            line-height: 1.5;
        }

        .tooltip {
            visibility: hidden;
            background-color: var(--tooltip-bg-color);
            color: var(--tooltip-text-color);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            line-height: 1.4;
            font-size: 0.9em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--tooltip-bg-color) transparent transparent transparent;
        }

        .guess-input-group:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .digit-control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .digit-control-group input[type="number"] {
            width: 80px;
            padding: 8px;
            background: var(--input-bg-color);
            color: var(--text-color);
            border: 2px solid var(--input-border-color);
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-box">
            <h2>ìˆ«ì ê²Œì„ ë„ìš°ë¯¸</h2>
            <div class="setting-group">
                <div class="digit-control-group">
                    <span>ìë¦¿ìˆ˜:</span>
                    <input type="number" id="digitCountInput" value="4" min="2" max="9">
                    <button id="resetButton" class="warning">ë¦¬ì…‹</button>
                </div>
            </div>
        </div>

        <div class="guess-box" id="guessBox">ìë¦¿ìˆ˜ë¥¼ ì„¤ì •í•˜ê³  ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</div>

        <div class="guess-input-group">
            <label for="feedbackInput">ê²°ê³¼ ì…ë ¥</label>
            <input type="text" id="feedbackInput" placeholder="ìë¦¿ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”." disabled/>
            <div class="tooltip">
                <p>ê²°ê³¼ë¥¼ ë‘ ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <p>ì²« ë²ˆì§¸ ìˆ«ì: ìŠ¤íŠ¸ë¼ì´í¬ (ìœ„ì¹˜ì™€ ìˆ«ìê°€ ëª¨ë‘ ì¼ì¹˜)</p>
                <p>ë‘ ë²ˆì§¸ ìˆ«ì: ë³¼ (ìˆ«ìëŠ” ì¼ì¹˜í•˜ì§€ë§Œ ìœ„ì¹˜ëŠ” ë‹¤ë¦„)</p>
                <p>ì˜ˆì‹œ: 2ìŠ¤íŠ¸ë¼ì´í¬, 1ë³¼ â†’ **21** ì…ë ¥</p>
                <p>ìŠ¤íŠ¸ë¼ì´í¬ + ë³¼ì˜ í•©ì€ ê²Œì„ ìë¦¿ìˆ˜ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
        
        <div class="buttons">
            <button id="startGameButton">ì‹œì‘</button>
            <button id="submitButton" disabled>ì…ë ¥</button>
            <button id="newGameButton">ìƒˆ ê²Œì„</button>
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        let candidates = [];
        let previousGuess = null;
        let previousFeedback = null;
        let currentGuess = null;
        let digitCount = 4;
        let isGameStarted = false;

        const guessBox = document.getElementById("guessBox");
        const feedbackInput = document.getElementById("feedbackInput");
        const logBox = document.getElementById("log");
        const digitCountInput = document.getElementById("digitCountInput");
        const startGameButton = document.getElementById("startGameButton");
        const submitButton = document.getElementById("submitButton");
        const newGameButton = document.getElementById("newGameButton");
        const resetButton = document.getElementById("resetButton");

        function generateCandidates() {
            candidates = [];
            const digits = '0123456789';
            function generate(current, used) {
                if (current.length === digitCount) {
                    candidates.push(current);
                    return;
                }
                for (let i = 0; i < 10; i++) {
                    const digit = digits[i];
                    if (!used.has(digit)) {
                        used.add(digit);
                        generate(current + digit, used);
                        used.delete(digit);
                    }
                }
            }
            generate('', new Set());
        }

        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function nextGuess() {
            if (candidates.length === 0) {
                guessBox.textContent = "í›„ë³´êµ°ì´ ì—†ìŠµë‹ˆë‹¤. ë¦¬ì…‹ í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.";
                return;
            }
            currentGuess = randomChoice(candidates);
            updateGuessBox();
        }

        function updateGuessBox() {
            guessBox.textContent = `ì œê°€ ì œì•ˆí•˜ëŠ” ìˆ«ì: ${currentGuess}`;
        }

        function parseFeedback(str) {
            const regex = new RegExp(`^[0-${digitCount}][0-${digitCount}]$`);
            if (!regex.test(str)) return null;
            const S = parseInt(str[0], 10);
            const B = parseInt(str[1], 10);
            if (S + B > digitCount) return null;
            return [S, B];
        }

        function filterCandidates(guess, S, B) {
            candidates = candidates.filter(candidate => {
                let strike = 0, ball = 0;
                for (let i = 0; i < digitCount; i++) {
                    if (candidate[i] === guess[i]) {
                        strike++;
                    } else if (guess.includes(candidate[i])) {
                        ball++;
                    }
                }
                return strike === S && ball === B;
            });
        }

        function submitFeedback() {
            if (!isGameStarted) return;

            const value = feedbackInput.value.trim();
            const feedback = parseFeedback(value);
            
            if (!feedback) {
                alert(`ì…ë ¥ í˜•ì‹ ì˜¤ë¥˜ ë˜ëŠ” ë¶ˆê°€ëŠ¥í•œ ì¡°í•©ì…ë‹ˆë‹¤. ì˜ˆ: ${digitCount-1}1, 0${digitCount}`);
                feedbackInput.value = '';
                return;
            }

            const [S, B] = feedback;
            logBox.innerHTML += `â¡ï¸ ì…ë ¥: ${value} (ìŠ¤íŠ¸ë¼ì´í¬ ${S}, ë³¼ ${B}) | ì œì•ˆ: ${currentGuess}\n`;
            logBox.scrollTop = logBox.scrollHeight;

            if (S === digitCount) {
                logBox.innerHTML += `âœ… ì •ë‹µì…ë‹ˆë‹¤! (${currentGuess}) ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.\n`;
                newGame();
                return;
            }

            filterCandidates(currentGuess, S, B);
            previousGuess = currentGuess;
            previousFeedback = feedback;
            feedbackInput.value = '';

            if (candidates.length === 0) {
                logBox.innerHTML += `âŒ í›„ë³´êµ°ì´ ì—†ì–´ì¡ŒìŠµë‹ˆë‹¤! ë¦¬ì…‹ í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.\n`;
                newGame();
                return;
            }

            nextGuess();
        }

        function startGame() {
            const newDigitCount = parseInt(digitCountInput.value, 10);
            if (newDigitCount < 2 || newDigitCount > 9) {
                alert("ìë¦¿ìˆ˜ëŠ” 2ìë¦¬ ì´ìƒ 9ìë¦¬ ì´í•˜ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            digitCount = newDigitCount;
            generateCandidates();
            isGameStarted = true;
            digitCountInput.disabled = true;
            startGameButton.disabled = true;
            newGameButton.disabled = false;
            submitButton.disabled = false;
            
            const maxStrikeExample = digitCount === 2 ? '1' : `${digitCount - 1}`;
            feedbackInput.placeholder = `ì˜ˆ: ${maxStrikeExample}1, 0${digitCount}`;
            
            logBox.textContent = `ğŸ‰ ${digitCount}ìë¦¬ ìˆ«ì ì•¼êµ¬ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!\n--------------------------------------------------\n`;
            nextGuess();
        }
        
        function newGame() {
            isGameStarted = false;
            candidates = [];
            previousGuess = null;
            previousFeedback = null;
            currentGuess = null;
            
            generateCandidates();
            isGameStarted = true;
            
            feedbackInput.disabled = false;
            submitButton.disabled = false;
            
            guessBox.textContent = 'ê²Œì„ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì¶”ì¸¡ì„ ì‹œì‘í•©ë‹ˆë‹¤.';
            feedbackInput.value = '';
            logBox.textContent = `--------------------------------------------------\nâœ¨ ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤! âœ¨\n--------------------------------------------------\n`;
            
            nextGuess();
        }

        function fullReset() {
            isGameStarted = false;
            candidates = [];
            previousGuess = null;
            previousFeedback = null;
            currentGuess = null;
            digitCount = 4;
            
            digitCountInput.disabled = false;
            startGameButton.disabled = false;
            newGameButton.disabled = true;
            submitButton.disabled = true;
            
            digitCountInput.value = 4;
            guessBox.textContent = 'ìë¦¿ìˆ˜ë¥¼ ì„¤ì •í•˜ê³  ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.';
            feedbackInput.value = '';
            feedbackInput.placeholder = 'ìë¦¿ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.';
            logBox.textContent = '';
        }

        startGameButton.addEventListener('click', startGame);
        submitButton.addEventListener('click', submitFeedback);
        newGameButton.addEventListener('click', newGame);
        resetButton.addEventListener('click', fullReset);

        feedbackInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                submitFeedback();
            }
        });

        // ì´ˆê¸°í™”
        fullReset();
    </script>
</body>
</html>
