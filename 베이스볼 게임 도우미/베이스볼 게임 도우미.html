<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>숫자 추리 게임 도우미</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --container-bg-color: #2c2c2c;
            --text-color: #f1f1f1;
            --primary-color: #4a90e2;
            --primary-hover-color: #3b7ad1;
            --input-bg-color: #383838;
            --input-border-color: #555;
            --log-bg-color: #232323;
            --log-border-color: #444;
            --font-family: 'Noto Sans KR', sans-serif;
            --tooltip-bg-color: #444;
            --tooltip-text-color: #fff;
            --warning-color: #e53e3e;
            --warning-hover-color: #c53030;
        }

        * {
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        body {
            background: var(--bg-color);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
        }

        .container {
            background: var(--container-bg-color);
            border-radius: 12px;
            padding: 30px;
            width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        .header-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-box h2 {
            margin: 0;
            font-weight: bold;
            color: var(--primary-color);
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-group button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .setting-group button.warning {
            background-color: var(--warning-color);
        }
        
        .setting-group button.warning:hover {
            background-color: var(--warning-hover-color);
        }

        .guess-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            background: rgba(74, 144, 226, 0.1);
        }

        .guess-input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .guess-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            background: var(--input-bg-color);
            color: var(--text-color);
            border: 2px solid var(--input-border-color);
            border-radius: 6px;
            transition: border 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: var(--primary-hover-color);
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        .log {
            height: 200px;
            overflow-y: auto;
            background: var(--log-bg-color);
            border: 1px solid var(--log-border-color);
            padding: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9rem;
            border-radius: 6px;
            white-space: pre-line;
            line-height: 1.5;
        }

        .tooltip {
            visibility: hidden;
            background-color: var(--tooltip-bg-color);
            color: var(--tooltip-text-color);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            line-height: 1.4;
            font-size: 0.9em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--tooltip-bg-color) transparent transparent transparent;
        }

        .guess-input-group:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .digit-control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .digit-control-group input[type="number"] {
            width: 80px;
            padding: 8px;
            background: var(--input-bg-color);
            color: var(--text-color);
            border: 2px solid var(--input-border-color);
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-box">
            <h2>숫자 게임 도우미</h2>
            <div class="setting-group">
                <div class="digit-control-group">
                    <span>자릿수:</span>
                    <input type="number" id="digitCountInput" value="4" min="2" max="9">
                    <button id="resetButton" class="warning">리셋</button>
                </div>
            </div>
        </div>

        <div class="guess-box" id="guessBox">자릿수를 설정하고 게임을 시작하세요.</div>

        <div class="guess-input-group">
            <label for="feedbackInput">결과 입력</label>
            <input type="text" id="feedbackInput" placeholder="자릿수를 설정하세요." disabled/>
            <div class="tooltip">
                <p>결과를 두 자리 숫자로 입력해주세요.</p>
                <p>첫 번째 숫자: 스트라이크 (위치와 숫자가 모두 일치)</p>
                <p>두 번째 숫자: 볼 (숫자는 일치하지만 위치는 다름)</p>
                <p>예시: 2스트라이크, 1볼 → **21** 입력</p>
                <p>스트라이크 + 볼의 합은 게임 자릿수를 초과할 수 없습니다.</p>
            </div>
        </div>
        
        <div class="buttons">
            <button id="startGameButton">시작</button>
            <button id="submitButton" disabled>입력</button>
            <button id="newGameButton">새 게임</button>
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        let candidates = [];
        let previousGuess = null;
        let previousFeedback = null;
        let currentGuess = null;
        let digitCount = 4;
        let isGameStarted = false;

        const guessBox = document.getElementById("guessBox");
        const feedbackInput = document.getElementById("feedbackInput");
        const logBox = document.getElementById("log");
        const digitCountInput = document.getElementById("digitCountInput");
        const startGameButton = document.getElementById("startGameButton");
        const submitButton = document.getElementById("submitButton");
        const newGameButton = document.getElementById("newGameButton");
        const resetButton = document.getElementById("resetButton");

        function generateCandidates() {
            candidates = [];
            const digits = '0123456789';
            function generate(current, used) {
                if (current.length === digitCount) {
                    candidates.push(current);
                    return;
                }
                for (let i = 0; i < 10; i++) {
                    const digit = digits[i];
                    if (!used.has(digit)) {
                        used.add(digit);
                        generate(current + digit, used);
                        used.delete(digit);
                    }
                }
            }
            generate('', new Set());
        }

        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function nextGuess() {
            if (candidates.length === 0) {
                guessBox.textContent = "후보군이 없습니다. 리셋 후 다시 시작하세요.";
                return;
            }
            currentGuess = randomChoice(candidates);
            updateGuessBox();
        }

        function updateGuessBox() {
            guessBox.textContent = `제가 제안하는 숫자: ${currentGuess}`;
        }

        function parseFeedback(str) {
            const regex = new RegExp(`^[0-${digitCount}][0-${digitCount}]$`);
            if (!regex.test(str)) return null;
            const S = parseInt(str[0], 10);
            const B = parseInt(str[1], 10);
            if (S + B > digitCount) return null;
            return [S, B];
        }

        function filterCandidates(guess, S, B) {
            candidates = candidates.filter(candidate => {
                let strike = 0, ball = 0;
                for (let i = 0; i < digitCount; i++) {
                    if (candidate[i] === guess[i]) {
                        strike++;
                    } else if (guess.includes(candidate[i])) {
                        ball++;
                    }
                }
                return strike === S && ball === B;
            });
        }

        function submitFeedback() {
            if (!isGameStarted) return;

            const value = feedbackInput.value.trim();
            const feedback = parseFeedback(value);
            
            if (!feedback) {
                alert(`입력 형식 오류 또는 불가능한 조합입니다. 예: ${digitCount-1}1, 0${digitCount}`);
                feedbackInput.value = '';
                return;
            }

            const [S, B] = feedback;
            logBox.innerHTML += `➡️ 입력: ${value} (스트라이크 ${S}, 볼 ${B}) | 제안: ${currentGuess}\n`;
            logBox.scrollTop = logBox.scrollHeight;

            if (S === digitCount) {
                logBox.innerHTML += `✅ 정답입니다! (${currentGuess}) 새 게임을 시작합니다.\n`;
                newGame();
                return;
            }

            filterCandidates(currentGuess, S, B);
            previousGuess = currentGuess;
            previousFeedback = feedback;
            feedbackInput.value = '';

            if (candidates.length === 0) {
                logBox.innerHTML += `❌ 후보군이 없어졌습니다! 리셋 후 다시 시작하세요.\n`;
                newGame();
                return;
            }

            nextGuess();
        }

        function startGame() {
            const newDigitCount = parseInt(digitCountInput.value, 10);
            if (newDigitCount < 2 || newDigitCount > 9) {
                alert("자릿수는 2자리 이상 9자리 이하로 설정해주세요.");
                return;
            }
            
            digitCount = newDigitCount;
            generateCandidates();
            isGameStarted = true;
            digitCountInput.disabled = true;
            startGameButton.disabled = true;
            newGameButton.disabled = false;
            submitButton.disabled = false;
            
            const maxStrikeExample = digitCount === 2 ? '1' : `${digitCount - 1}`;
            feedbackInput.placeholder = `예: ${maxStrikeExample}1, 0${digitCount}`;
            
            logBox.textContent = `🎉 ${digitCount}자리 숫자 야구 게임을 시작합니다!\n--------------------------------------------------\n`;
            nextGuess();
        }
        
        function newGame() {
            isGameStarted = false;
            candidates = [];
            previousGuess = null;
            previousFeedback = null;
            currentGuess = null;
            
            generateCandidates();
            isGameStarted = true;
            
            feedbackInput.disabled = false;
            submitButton.disabled = false;
            
            guessBox.textContent = '게임이 리셋되었습니다. 새로운 추측을 시작합니다.';
            feedbackInput.value = '';
            logBox.textContent = `--------------------------------------------------\n✨ 새 게임을 시작합니다! ✨\n--------------------------------------------------\n`;
            
            nextGuess();
        }

        function fullReset() {
            isGameStarted = false;
            candidates = [];
            previousGuess = null;
            previousFeedback = null;
            currentGuess = null;
            digitCount = 4;
            
            digitCountInput.disabled = false;
            startGameButton.disabled = false;
            newGameButton.disabled = true;
            submitButton.disabled = true;
            
            digitCountInput.value = 4;
            guessBox.textContent = '자릿수를 설정하고 게임을 시작하세요.';
            feedbackInput.value = '';
            feedbackInput.placeholder = '자릿수를 설정하세요.';
            logBox.textContent = '';
        }

        startGameButton.addEventListener('click', startGame);
        submitButton.addEventListener('click', submitFeedback);
        newGameButton.addEventListener('click', newGame);
        resetButton.addEventListener('click', fullReset);

        feedbackInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                submitFeedback();
            }
        });

        // 초기화
        fullReset();
    </script>
</body>
</html>
